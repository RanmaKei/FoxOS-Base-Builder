#version=DEVEL
text
lang en_US.UTF-8
keyboard us

# Network via DHCP
network --bootproto=dhcp --device=link --activate

# Install source: Fedora 42 Everything x86_64
url --url="https://download.fedoraproject.org/pub/fedora/linux/releases/42/Everything/x86_64/os/"

timezone UTC --isUtc

# Lock root, use foxos as main user
rootpw --lock

# Create foxos user
# Generate your own hash with: openssl passwd -6 'your-password'
user --name=foxos --groups=wheel --password=$6$M0fdzC5Gc/a3srzn$dYc9zK64ZXsOUlSl73NzI349quHidm1O0Yp83zF1Xmjwsw3gTRqJqWIqRe7fHfae.xz0qDIPsko2sV885XwkM/ --iscrypted

bootloader --location=mbr --boot-drive=vda

# Simple automatic partitioning with LVM
autopart --type=lvm

firewall --enabled --service=ssh
selinux --enforcing
authselect --useshadow --passalgo=sha512

%packages
@^minimal-environment
sudo
openssh-server
qemu-guest-agent
# Add anything else you ALWAYS want present in FoxOS base
%end

%post
set -e

# Enable sshd
systemctl enable sshd

# Passwordless sudo for foxos
echo "foxos ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/99-foxos
chmod 440 /etc/sudoers.d/99-foxos

# Optional: marker for first-boot logic if you ever want it
# touch /var/lib/foxos-firstboot.todo

%end

%addon com_redhat_kdump --disable
%end

reboot
